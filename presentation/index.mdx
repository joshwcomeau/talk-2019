import { Cite } from 'spectacle'
import CodeSlide from 'spectacle-code-slide'

import { LightSlide } from './slides'
import RegularComponent from './regular-component'
import TitleCard from '../src/components/TitleCard'
import PoppingCircle from '../src/components/PoppingCircle'
import Spacer from '../src/components/Spacer'
import SpacedRow from '../src/components/SpacedRow'
import Avatar from '../src/components/Avatar'
import Footnote from '../src/components/Footnote'
import AnimationIntroScreen from '../src/components/AnimationIntroScreen'
import ExternalLink from '../src/components/ExternalLink'

import './index.css'

# üëãüèª Good morning!

---

My name‚Äôs Josh.

I flew here from Canada.

# üõ´

---

Raise your hand if you flew here as well

‚úã

---

Raise your hand if you enjoyed your flight

‚úã

---

Flying is **amazing**

---

...but it doesn't always feel amazing.

---

Let's talk about

### Boarding

---

import boardStupidSrc from '../assets/plane-boarding-stupid.png'

<img src={boardStupidSrc} style={{ width: '100%' }} />

---

import boardRankedSrc from '../assets/plane-boarding-methods-ranked.png'

<img src={boardRankedSrc} style={{ width: '100%' }} />

---

import mythbustersSrc from '../assets/mythbusters.mp4'

<video autoPlay src={mythbustersSrc} style={{ width: '100%' }} />

---

import unitedSrc from '../assets/united.mp4'

<video controls src={unitedSrc} style={{ width: '100%' }} />

---

Boarding is indeed important...

---

...But is boarding _really_ the biggest problem with air travel?

---

What does this have to do with anything?

---

# Performance

---

<TitleCard />

---

Why does this matter?

<!--

It's easy to make the case for page-load time;
If someone spends more than X seconds staring at a blank screen after
clicking the link to your site, they'll eventually bail. You get less visitors.

-->

---

# Mobile > Web

---

import mattPerryDevSrc from '../assets/matt-perry-dev.jpg'
import chantasticSrc from '../assets/chantastic.jpg'

<SpacedRow>
  <Avatar name="Matt G Perry" src={mattPerryDevSrc} />
  <Avatar name="Chantastic" src={chantasticSrc} />
</SpacedRow>

<Footnote
  title="React Podcast #35"
  subtitle="Make the Web Look Great, with Matt Perry"
  href="https://reactpodcast.simplecast.fm/35"
/>

---

## Relevance

<!-- Matt Perry's ideas about the web as a uniquely open platform -->

---

The web is an amazing open platform.

---

import codesandboxNetlifySrc from '../assets/codesandbox-netlify.jpg'

<img src={codesandboxNetlifySrc} style={{ width: '100%' }} />

---

It is incredibly **low-friction** to ship something on the web.

The web is full of delightful, oddball experiences because of it.

---

In order to keep the web relevant, we need to create native-mobile-quality experiences.

---

<AnimationIntroScreen title="Accordions" />

---

<!--

- Go to the bootstrap accordion demo, show how it works
- Pull up the devtools
- Record opening and closing
- Explain the FPS count - ideally we want 60fps. This is the native refresh rate of a lot of devices, and it's also just a buttery target.
- 60fps -> 16.6ms/frame
- zoom into a slower frame
- Focus on layout and paint
- Show how the ENTIRE PAGE is being repainted
-->

[Bootstrap Accordion example](https://getbootstrap.com/docs/4.0/components/collapse/#accordion-example)

---

The Bootstrap accordion is slow because it _blows the budget_.

Every frame takes way more than 16ms.

---

import greenPixelsSrc from '../assets/green-pixels.mp4'

The Pixel Pipeline

<video
  src={greenPixelsSrc}
  autoPlay
  loop
  style={{ width: 300, height: 300, borderRadius: 1000, objectFit: 'cover' }}
/>

---

import pixelPipelineSrc from '../assets/pixel-pipeline.jpg'

export default LightSlide

<img src={pixelPipelineSrc} style={{ width: '100%' }} />

---

import noLayoutPaint from '../assets/frame-no-layout-paint.jpg'

export const transition = ['none']

export default LightSlide

<img src={noLayoutPaint} style={{ width: '100%' }} />

---

Properties like `background-color` don't trigger layout.

---

import cssTriggersSrc from '../assets/csstriggers.png'

<img src={cssTriggersSrc} style={{ width: '100%' }} />

[https://csstriggers.com/](https://csstriggers.com/)

---

We should rely primarily on two properties that can skip layout _and_ paint:

`opacity` and `transform`

---

Playground showing the different properties we can animate

---

# A better accordion?

---

We can't build _exactly_ that animation, but we can build something close.

---

import AccordionExample from '../src/components/Accordion/Accordion.example'

<AccordionExample />

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/accordion.usage.example')}
    ranges={[
      { loc: [0, 5], title: 'Desired API' },
      { loc: [9, 18], note: 'Alternative API' },
    ]}
  />
)

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/accordion.example')}
    ranges={[
      { loc: [0], title: 'Accordion.jsx' },
      { loc: [3, 4] },
      { loc: [4, 9] },
      { loc: [9, 19] },
    ]}
  />
)

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/accordion.item.example')}
    ranges={[
      { loc: [0], title: 'Accordion.Item.jsx' },
      { loc: [8, 9] },
      { loc: [9, 13] },
      { loc: [14, 17] },
      { loc: [18, 19] },
      { loc: [23, 29] },
      { loc: [33, 40] },
      { loc: [49, 50] },
      { loc: [40, 48] },
      { loc: [52, 62] },
    ]}
  />
)

---

export default props => (
  <CodeSlide
    {...props}
    lang="js"
    code={require('raw-loader!./code/accordion.item.css.example')}
    ranges={[
      { loc: [0], title: 'Accordion.Item.css' },
      { loc: [0, 9] },
      { loc: [10, 19] },
      { loc: [21, 27] },
    ]}
  />
)

---

`will-change` allows the browser to push<br />this element onto its own layer.

This enables animations to skip the<br />"paint" step in the pixel pipeline!

---

# Working with design

---

Work collaboratively. Build trust.

<!--

Talk about how engineers ultimately control what ships, and that we should
pick our battles.

Note that design is often so insistent because engineers are lazy. By going the extra mile when it is performant to do so, we build trust with design, and they'll be more likely to accept it when we say "this animation just can't be done performantly on the web"

It's best when designers and engineers collaborate. Understanding the limitations of the web platform is our job, that's what we bring to the collaboration.

-->

---

# Don't be afraid to break the rules\*

\*As long as you're profiling!

---

import khanMenu from '../assets/khan-menu.gif'

<img src={khanMenu} />

---

<AnimationIntroScreen title="Like Button" />

---

import Tweet from '../src/components/Tweet/Tweet.managed'

<SpacedRow>
  <Tweet tweetContents="Hello React Europe! üëãüèª" />
</SpacedRow>

---

import LikeButton from '../src/components/LikeButton/LikeButton.managed'

<LikeButton size={160} />

---

Trigonometry!

---

Dig into the code a bit for the original

---

# Sprites

---

import LikeSprite from '../src/components/LikeSprite'

<LikeSprite />

## Show the sprite version

---

Show process with Giphy, ezgif, photoshop

---

Is this better? Dig into profiler

---

Show Vincent's animation analysis tool thing. Not only is it much less work, it isn't blocked by JS.

---

<AnimationIntroScreen title="Offscreen Canvas" />

---

Quick Tinkersynth demo

---

# The Problem

The art generation function is slow.

Painting to canvas is slow.

---

# Web Workers

We can do all of the art calculations in a worker.

Workers don't have access to the DOM, though, so painting to canvas is still really slow.

---

# OffscreenCanvas

OffscreenCanvas is a _separate thread_ that has _access to the Canvas DOM node_.

---

Show before/after

---

# Conclusion
