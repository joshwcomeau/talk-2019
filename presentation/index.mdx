import { Cite } from 'spectacle'
import CodeSlide from 'spectacle-code-slide'

import { LightSlide } from './slides'
import RegularComponent from './regular-component'
import TitleCard from '../src/components/TitleCard'
import PoppingCircle from '../src/components/PoppingCircle'
import Spacer from '../src/components/Spacer'
import SpacedRow from '../src/components/SpacedRow'
import Avatar from '../src/components/Avatar'
import Footnote from '../src/components/Footnote'
import AnimationIntroScreen from '../src/components/AnimationIntroScreen'
import ExternalLink from '../src/components/ExternalLink'

import './index.css'

# üëãüèª Good morning!

---

My name‚Äôs Josh.

I flew here from Canada.

# üõ´

---

Raise your hand if you flew here as well

‚úã

---

Keep your hand raised if you enjoyed your flight

---

Flying is **amazing**

<!--

I flew >5000km.

Flying is ~100 years old.

-->

---

...but it doesn't always feel amazing.

---

Let's talk about

### Boarding

---

import boardRankedSrc from '../assets/plane-boarding-methods-ranked.png'

<img src={boardRankedSrc} style={{ width: '100%' }} />

---

import boardStupidSrc from '../assets/plane-boarding-stupid.png'

<img src={boardStupidSrc} style={{ width: '100%' }} />

---

import mythbustersSrc from '../assets/mythbusters.mp4'

<video autoPlay src={mythbustersSrc} style={{ width: '100%' }} />

---

Boarding is indeed important...

---

...But is boarding _really_ the biggest problem with air travel?

---

What does this have to do with anything?

---

# Performance

---

### Things we optimize for performance:

- Server-side rendering
- Code-splitting
- Reducing bundle sizes
- HTTP/2
- Lazy-loading assets

---

### Things we don't think about so much:

- Everything after the page loads

---

import pieSrc from '../assets/pie-opaque.png'

export default LightSlide

<img src={pieSrc} style={{ width: '100%' }} />

---

<TitleCard />

---

Why is after-load performance important?

<!--

It's easy to make the case for page-load time;
If someone spends more than X seconds staring at a blank screen after
clicking the link to your site, they'll eventually bail. You get less visitors.

-->

---

# Mobile vs. Web

<!--

It's a pain to get a mobile app. Have to use the app store, agree to terms, download several hundred megabytes, deal with annoying push notifications.

-->

---

import mattPerryDevSrc from '../assets/matt-perry-dev.jpg'
import chantasticSrc from '../assets/chantastic.jpg'

<SpacedRow>
  <Avatar name="Matt G Perry" src={mattPerryDevSrc} />
  <Avatar name="Chantastic" src={chantasticSrc} />
</SpacedRow>

<Footnote
  title="React Podcast #35"
  subtitle="Make the Web Look Great, with Matt Perry"
  href="https://reactpodcast.simplecast.fm/35"
/>

---

## Relevance

<!-- Matt Perry's ideas about the web as a uniquely open platform -->

---

The web is an amazing open platform.

---

import codesandboxNetlifySrc from '../assets/codesandbox-netlify.jpg'

<img src={codesandboxNetlifySrc} style={{ width: '100%' }} />

---

import webflowSrc from '../assets/webflow.mp4'

<video autoPlay src={webflowSrc} style={{ width: '100%' }} />

---

It is incredibly **low-friction** to ship something on the web.

The web is content-rich because of it.

---

In order to keep the web relevant, we need to create native-mobile-quality experiences.

---

<AnimationIntroScreen title="Accordions" />

---

<!--

- Go to the bootstrap accordion demo, show how it works
- Pull up the devtools
- Record opening and closing
- Explain the FPS count - ideally we want 60fps. This is the native refresh rate of a lot of devices, and it's also just a buttery target.
- 60fps -> 16.6ms/frame
- zoom into a slower frame
- Focus on layout and paint
- Show how the ENTIRE PAGE is being repainted
-->

[Bootstrap Accordion example](https://getbootstrap.com/docs/4.0/components/collapse/#accordion-example)

---

import greenPixelsSrc from '../assets/green-pixels.mp4'

The Pixel Pipeline

<video
  src={greenPixelsSrc}
  autoPlay
  loop
  style={{ width: 300, height: 300, borderRadius: 1000, objectFit: 'cover' }}
/>

---

import pixelPipelineSrc from '../assets/pixel-pipeline.jpg'

export default LightSlide

<img src={pixelPipelineSrc} style={{ width: '100%' }} />

---

import noLayoutPaint from '../assets/frame-no-layout-paint.jpg'

export const transition = ['none']

export default LightSlide

<img src={noLayoutPaint} style={{ width: '100%' }} />

---

Properties like `background-color` don't trigger layout.

---

import cssTriggersSrc from '../assets/csstriggers.png'

<img src={cssTriggersSrc} style={{ width: '100%' }} />

[https://csstriggers.com/](https://csstriggers.com/)

---

We should rely primarily on two properties that can skip layout _and_ paint:

`opacity` and `transform`

---

# A better accordion?

---

We can't build _exactly_ that animation, but we can build something close.

---

import AccordionExample from '../src/components/Accordion/Accordion.example'

<AccordionExample />

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/accordion.usage.example')}
    ranges={[
      { loc: [0, 5], title: 'Desired API' },
      { loc: [9, 18], note: 'Alternative API' },
    ]}
  />
)

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/accordion.example')}
    ranges={[
      { loc: [0], title: 'Accordion.jsx' },
      { loc: [3, 4] },
      { loc: [4, 9] },
      { loc: [9, 19] },
    ]}
  />
)

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/accordion.item.example')}
    ranges={[
      { loc: [0], title: 'Accordion.Item.jsx' },
      { loc: [8, 9] },
      { loc: [9, 13] },
      { loc: [14, 15] },
      { loc: [16, 17] },
      { loc: [21, 27] },
      { loc: [31, 38] },
      { loc: [47, 48] },
      { loc: [38, 46] },
      { loc: [50, 60] },
    ]}
  />
)

---

export default props => (
  <CodeSlide
    {...props}
    lang="js"
    code={require('raw-loader!./code/accordion.item.css.example')}
    ranges={[
      { loc: [0], title: 'Accordion.Item.css' },
      { loc: [0, 9] },
      { loc: [10, 19] },
      { loc: [21, 27] },
    ]}
  />
)

---

`will-change` allows the browser to push<br />this element onto its own layer.

This enables animations to skip the<br />"paint" step in the pixel pipeline!

---

# Don't be afraid to break the rules\*

\*As long as you're profiling!

---

import khanMenu from '../assets/khan-menu.gif'

<img src={khanMenu} />

---

<AnimationIntroScreen title="Like Button" />

---

import Tweet from '../src/components/Tweet/Tweet.managed'

<SpacedRow>
  <Tweet tweetContents="Hello React Europe! üëãüèª" />
</SpacedRow>

---

import LikeButton from '../src/components/LikeButton/LikeButton.managed'

<LikeButton size={160} />

---

export default props => (
  <CodeSlide
    {...props}
    lang="js"
    code={require('raw-loader!./code/particle-api.example')}
    ranges={[
      { loc: [0], title: 'Particle usage' },
      { loc: [0, 4] },
      { loc: [4, 5] },
    ]}
  />
)

---

# Trigonometry!

jspaint.app

<!-- soh-cah-toa, figuring out angle and distance -->

---

export default props => (
  <CodeSlide
    {...props}
    lang="jsx"
    code={require('raw-loader!./code/particle.example')}
    ranges={[
      { loc: [0], title: 'Particle.js' },
      { loc: [2, 7] },
      { loc: [7, 9] },
      { loc: [10, 14] },
      { loc: [15, 21] },
      { loc: [22, 27] },
    ]}
  />
)

---

Wait this is a performance talk

---

Show the not-too-bad performance

---

Show Vincent's tool, that shows JS lag

---

# Options:

1. Use CSS transitions
2. Sprites

---

import LikeSprite from '../src/components/LikeSprite'

<LikeSprite />

---

Show how great it is perf-wise

---

Show process with ezgif, photoshop

---

<AnimationIntroScreen title="Offscreen Canvas" />

---

Quick Tinkersynth demo

<!--

show off the product.

Talk about the expensiveness of calculating every line

Mention trigonometry, when showing the polar control

-->

---

# Web Workers

We can do all of the art calculations in a worker.

Workers don't have access to the DOM, though, so painting to canvas is still really slow.

---

# OffscreenCanvas

OffscreenCanvas is a _separate thread_ that has _access to the Canvas DOM node_.

---

Show before/after

---

# Conclusion

---

#### Dystopian future:

the web becomes a relic that only grandparents use.

---

We can help **preserve the web's relevance** by building good, polished products.

---

Smooth animations and interactions are a hallmark of quality.

---

Thank you!

All code samples available through Twitter:

<span style={{ fontSize: 72, color: '#6FA0FF' }}>{'@JoshWComeau'}</span>
